#ifndef _ADDRS_55X_H
#define _ADDRS_55X_H

#include "config.h"

#if IOS_VERSION == 555

/********
 * FS
 * ******/


// dev note: example first partition entry at MBR+0x1BE: 00202100AEFEFFFF00080000 0000001C. last u32 is shrunken sector count, little-endian
#define NOCRYPTO_WFS_SECTOR_COUNT1 (USB_SHRINK_SECTOR_COUNT1 & 0xFFFF0000)
#define NOCRYPTO_WFS_SECTOR_COUNT2 (USB_SHRINK_SECTOR_COUNT2 & 0xFFFF0000)
#define NOCRYPTO_WFS_SECTOR_COUNT3 (USB_SHRINK_SECTOR_COUNT3 & 0xFFFF0000)

#define SECTION_BASE 0x10700000
#define SECTION_SIZE 0x000F8200
#define BSS_START    0x10835000
#define BSS_SIZE     0x01406554
#define CODE_BASE    (SECTION_BASE + SECTION_SIZE)
#define FS_BSS_START (0x10835000 + 0x1406554)

// NUM_SECTORS in these calculations is total (sd_sectors & 0xFFFF0000)
// fatfs size to use (mb) is ((NUM_SECTORS - MLC_SIZE - 0x200800) / 0x800) - 1
// OFFS_SECTORS is count subtracted from num_sectors
#define USB_OFFS_SECTORS (0) // unused atm

#define FS_MMC_SDCARD_STRUCT (0x1089B9F8)
#define FS_MMC_MLC_STRUCT (0x1089B948)
#define SCFM_FSA_HANDLE_PTR 0x1108B8B4

#define FSA_STATUS_NOT_FOUND 0xFFFCFFE9

#define FS_FSAMOUNT 0x107F0430
#define FS_FSAUNMOUNT 0x107F030C
#define FS_FSAOPENFILE 0x107EFC14 
#define FS_FSACLOSEFILE 0x107EEC20
#define FS_FSAREMOVEFILE 0x107EEB20
#define FS_FSAREADFILEOFFSET 0x107EF594
#define FS_FSAWRITEFILEOFFSET 0x107EEF14
#define FS_IOS_MEMALIGN 0x107F6A44
#define FS_IOS_FREE 0x107F6A4C

#define FS_SLEEP 0x1071D668
#define FS_SYSLOG_OUTPUT 0x107F0C84
#define FS_GETMDDEVICEBYID 0x107187C4
#define FS_SDIO_DOREADWRITECOMMAND 0x10718A8C
//#define FS_SDIO_DOCOMMAND 0x1071C958
//#define FS_MMC_DEVICEINITSOMETHING 0x1071992C
//#define FS_MMC_DEVICEINITSOMETHING2 0x1071A4A4
//#define FS_MMC_DEVICEINITSOMETHING3 0x10719F60
//#define FS_SVC_CREATEMUTEX 0x107F6BBC
//#define FS_SVC_ACQUIREMUTEX 0x107F6BC4
//#define FS_SVC_RELEASEMUTEX 0x107F6BCC
//#define FS_SVC_DESTROYMUTEX 0x107F6BD4

#define FS_USB_READ                 (0x1077F1C0)
#define FS_USB_WRITE                (0x1077F35C)
#define FS_USB_SECTOR_SPOOF         (0x10781228)

#define FS_SLC_READ1                (0x107B998C)
#define FS_SLC_READ2                (0x107B98FC)
#define FS_SLC_WRITE1               (0x107B9870)
#define FS_SLC_WRITE2               (0x107B97E4)
#define FS_SLC_HANDLEMESSAGE        (0x107B9DE4)
#define FS_MLC_READ1                (0x107DC760)
#define FS_MLC_READ2                (0x107DCDE4)
#define FS_MLC_WRITE1               (0x107DC0C0)
#define FS_MLC_WRITE2               (0x107DC73C)
#define FS_SDCARD_READ1             (0x107BDDD4)
#define FS_SDCARD_WRITE1            (0x107BDD64)
#define FS_ISFS_READWRITEBLOCKS     (0x10720324)
#define FS_CRYPTO_HMAC              (0x107F3798)
#define FS_RAW_READ1                (0x10732BC0)
#define FS_REGISTERMDPHYSICALDEVICE (0x10718860)
#define FS_OPENDIR_BASE             (0x1070B7F4)
#define WFS_CRYPTO_HOOK_ADDR        (0x10740EF8)
#define WFS_CRYPTO_HOOK_RET_ADDR    (0x10740EFC)
#define FS_GET_FULL_DIR_STR         (0x1070E91C)
//#define FS_REGISTER_FS_DRIVER  0x10732D70

#define FSA_BASE (0x10700000)
#define REL_FS(addr) (addr - FSA_BASE + (FSA_BASE-FS_ALT_BASE))
#define REL_FS_SYSLOG_OUTPUT REL_FS(FS_SYSLOG_OUTPUT)
#define REL_FS_SDIO_DOREADWRITECOMMAND REL_FS(FS_SDIO_DOREADWRITECOMMAND)
#define REL_FS_REGISTERMDPHYSICALDEVICE REL_FS(FS_REGISTERMDPHYSICALDEVICE)
#define REL_FS_USB_SECTOR_SPOOF REL_FS(FS_USB_SECTOR_SPOOF)
#define REL_FS_USB_READ REL_FS(FS_USB_READ)
#define REL_FS_USB_WRITE REL_FS(FS_USB_WRITE)
#define REL_FS_SLC_READ1 REL_FS(FS_SLC_READ1)
#define REL_FS_SLC_WRITE1 REL_FS(FS_SLC_WRITE1)
#define REL_FS_SLC_READ2 REL_FS(FS_SLC_READ2)
#define REL_FS_SLC_WRITE2 REL_FS(FS_SLC_WRITE2)
#define REL_FS_RAW_READ1 REL_FS(FS_RAW_READ1)
#define REL_FS_OPENDIR_BASE REL_FS(FS_OPENDIR_BASE)
#define REL_WFS_CRYPTO_HOOK_RET_ADDR REL_FS(WFS_CRYPTO_HOOK_RET_ADDR)
#define REL_FS_GET_FULL_DIR_STR REL_FS(FS_GET_FULL_DIR_STR)
#define REL_FS_SLEEP REL_FS(FS_SLEEP)
//#define REL_ REL_FS()

#define MCP_SYSLOG_OUTPUT_ADDR (0x0503DCF8)
#define PAD_SYSLOG_OUTPUT_ADDR (0x11F7EF98)
#define FS_GET_SPECIFIC_DEVNAME_HOOK_ADDR (0x107112B0)

#define FSSCFMInit 0x107e7604
#define FSSCFMExit 0x107e5fc8

#define KERNEL_IO_MAPPINGS_MCP        0x08140DE0
#define KERNEL_IO_MAPPINGS_MCP_NUMBER 0x08140DE4
#define KERNEL_IO_MAPPINGS_MCP_PID    0x08140DE8
#define KERNEL_DARC_WRITE 0x081253C0
#define KERNEL_DARC_NET_PATCH 0x081253b8
#define KERNEL_AP_BITS_1M 0x08124678
#define KERNEL_AP_BITS_SECOND 0x08124D88
#define KERNEL_ENABLE_SYSPROT 0x081223FC
#define KERNEL_OTP_READ_CHECK1 0x08120374
#define KERNEL_OTP_READ_CHECK2 0x081203C4
#define KERNEL_POINTER_CHECK 0x08124AD8
#define KERNEL_INSN_ABORT 0x0812A134
#define KERNEL_DATA_ABORT 0x0812A1AC
#define KERNEL_UNDEF_INSN_ABORT 0x08129E50
#define KERNEL_PANIC_HOOK 0x08129AA0

#define FS_PRINTF 0x107F5720

// SD diag_ios_9000
#elif IOS_VERSION == 9000

#define KERNEL_IO_MAPPINGS_MCP        0x08140b84
#define KERNEL_IO_MAPPINGS_MCP_NUMBER 0x08140b88
#define KERNEL_IO_MAPPINGS_MCP_PID    0x08140b8c
#define KERNEL_DARC_WRITE 0x081259dc
#define KERNEL_DARC_NET_PATCH 0x81259d4
#define KERNEL_AP_BITS_1M 0x081251c8
#define KERNEL_AP_BITS_SECOND 0x08125438
#define KERNEL_ENABLE_SYSPROT 0x08122fd8
#define KERNEL_OTP_READ_CHECK1 0x0812034c
#define KERNEL_OTP_READ_CHECK2 0x0812039c
#define KERNEL_POINTER_CHECK 0x08125028
#define KERNEL_INSN_ABORT 0x08128f2c
#define KERNEL_DATA_ABORT 0x08128fa4
#define KERNEL_UNDEF_INSN_ABORT 0x08128de0
#define KERNEL_PANIC_HOOK 0x08128c78

#define FS_PRINTF 0x108bfd68
#define FSSCFMInit 0
#define FSSCFMExit 0

// these are all wrong. Just there to make it compile
#define FS_USB_READ                 (0x1077F1C0)
#define FS_USB_WRITE                (0x1077F35C)
#define FS_USB_SECTOR_SPOOF         (0x10781228)

#define FS_SLC_READ1                (0x107B998C)
#define FS_SLC_READ2                (0x107B98FC)
#define FS_SLC_WRITE1               (0x107B9870)
#define FS_SLC_WRITE2               (0x107B97E4)
#define FS_SLC_HANDLEMESSAGE        (0x107B9DE4)
#define FS_MLC_READ1                (0x107DC760)
#define FS_MLC_READ2                (0x107DCDE4)
#define FS_MLC_WRITE1               (0x107DC0C0)
#define FS_MLC_WRITE2               (0x107DC73C)
#define FS_SDCARD_READ1             (0x107BDDD4)
#define FS_SDCARD_WRITE1            (0x107BDD64)
#define FS_ISFS_READWRITEBLOCKS     (0x10720324)
#define FS_CRYPTO_HMAC              (0x107F3798)
#define FS_RAW_READ1                (0x10732BC0)
#define FS_REGISTERMDPHYSICALDEVICE (0x10718860)
#define FS_OPENDIR_BASE             (0x1070B7F4)
#define WFS_CRYPTO_HOOK_ADDR        (0x10740EF8)
#define WFS_CRYPTO_HOOK_RET_ADDR    (0x10740EFC)
#define FS_GET_FULL_DIR_STR         (0x1070E91C)
//#define FS_REGISTER_FS_DRIVER  0x10732D70

#define FSA_BASE (0x10700000)
#define REL_FS(addr) (addr - FSA_BASE + (FSA_BASE-FS_ALT_BASE))
#define REL_FS_SYSLOG_OUTPUT REL_FS(FS_SYSLOG_OUTPUT)
#define REL_FS_SDIO_DOREADWRITECOMMAND REL_FS(FS_SDIO_DOREADWRITECOMMAND)
#define REL_FS_REGISTERMDPHYSICALDEVICE REL_FS(FS_REGISTERMDPHYSICALDEVICE)
#define REL_FS_USB_SECTOR_SPOOF REL_FS(FS_USB_SECTOR_SPOOF)
#define REL_FS_USB_READ REL_FS(FS_USB_READ)
#define REL_FS_USB_WRITE REL_FS(FS_USB_WRITE)
#define REL_FS_SLC_READ1 REL_FS(FS_SLC_READ1)
#define REL_FS_SLC_WRITE1 REL_FS(FS_SLC_WRITE1)
#define REL_FS_SLC_READ2 REL_FS(FS_SLC_READ2)
#define REL_FS_SLC_WRITE2 REL_FS(FS_SLC_WRITE2)
#define REL_FS_RAW_READ1 REL_FS(FS_RAW_READ1)
#define REL_FS_OPENDIR_BASE REL_FS(FS_OPENDIR_BASE)
#define REL_WFS_CRYPTO_HOOK_RET_ADDR REL_FS(WFS_CRYPTO_HOOK_RET_ADDR)
#define REL_FS_GET_FULL_DIR_STR REL_FS(FS_GET_FULL_DIR_STR)
#define REL_FS_SLEEP REL_FS(FS_SLEEP)


#else
#error "Unsupported IOS" 
#endif

#define HAI_PARAM_POINTER (0x050749d8)
#define HAI_IOS_PADDR_PTR 0x1018
#define HAI_IOS_SIZE 0x260000

#endif // _ADDRS_55X_H